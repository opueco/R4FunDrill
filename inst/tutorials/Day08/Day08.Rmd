---
title: "Day08 ドリル"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

## 1. 対応のある2標本のt検定  {#paired}

<http://www.geisya.or.jp/~mwm48961/statistics/ttest_question1.htm>

次のデータフレームの行はある被験者のある年の最高血圧（A) と翌年の最高血圧（B)を記録したものである。AとBの平均に差があるかを検定せよ。

```{r, echo=TRUE}
df <- data.frame(
  A = 100 + c(9, 15, 7, 24, 23, 12, 28, 19, 21, 24, 23, 23),
  B = 100 + c(5, 0, 18, 22, 22, 25, 1, 28, 4, 7, 3, 28)
)
df
```

`df$A` と `df$B` は対応のあるデータである。t検定をするには，差をとって `t.test()` を使う。

```r
t.test(df$A - df$B)
```

または，`paired = TRUE` を渡せばよい。

```r
t.test(df$A, df$B, paired = TRUE)
```

もし「`df$A > df$B`」 となっているかどうかだけを知りたい場合には，

```r
t.test(df$A, df$B, paired = TRUE, alternative = "greater")
```

とすればよい。


#### 課題

上の3つのコードを試してください。

```{r paired1, exercise=TRUE, exercise.lines=6}
df <- data.frame(
  A = 100 + c(9, 15, 7, 24, 23, 12, 28, 19, 21, 24, 23, 23),
  B = 100 + c(5, 0, 18, 22, 22, 25, 1, 28, 4, 7, 3, 28)
)
```


### 問題

次の表は異なる環境で育った一卵性双生児の20歳時点での体重の一覧表であるとする。
遺伝的な要因以外の要因が体重を決める上で重要かどうかを知りたい。対応のある t検定を使って，検証してください。

<div style="width:200px;">
| No | A | B |
|---:|---:|---:|
| 1 | 43 | 50 |
| 2 | 54 | 44 |
| 3 | 38 | 50 |
| 4 | 41 | 44 |
| 5 | 47 | 38 |
| 6 | 35 | 55 |
| 7 | 38 | 44 |
| 8 | 39 | 37 |
| 9 | 45 | 59 |
| 10 | 35 | 44 |
| 11 | 57 | 57 |
| 12 | 51 | 45 |
| 13 | 58 | 38 |
</div>

```{r paired2, exercise=TRUE}

```




## 2. 対応のない2標本のt検定 {#welch}

特別な対応関係のない2組の標本があるとする。これらの標本の母平均に差があるかを知りたい。
例えば，

- 有効性を確認したい薬を与えた群
- 偽薬を与えた群

を比較するといった問題が典型的な適用例である。

次の統計量を調べるとよい。


$$
t=\frac{\bar{X}-\bar{Y}}{\sqrt{\frac{s_{X}^{2}}{m}+\frac{s_{Y}^{2}}{n}}}
$$

これは近似的に t分布に従う。自由度は

$$
\nu=\frac{\left(\frac{s_{X}^{2}}{m}+\frac{s_{Y}^{2}}{n}\right)^{2}}{\frac{1}{m-1}\left(\frac{s_{X}^{2}}{m}\right)^{2}+\frac{1}{n-1}\left(\frac{s_{Y}^{2}}{n}\right)^{2}}
$$

この統計量を用いた検定をウェルチのt検定という。

生データがある場合は 

```r
t.test(X, Y)
```

とするだけでよい。平均や分散を計算した後のデータだけが知らされている場合には原理に立ち帰って計算する必要がある。一度やってみよう。


### 問題1

$$
m = 12,\quad \bar{X} = 50, \quad s_X^2 = 8
$$
$$
n = 15, \quad \bar{Y} = 53, \quad s_Y^2 = 9
$$

であるとする。このとき，第1群と第2群で母平均に差があると言えるか。有意水準5% で検定せよ。

```{r welch1, exercise = TRUE}
m <- 12; X <- 50; sx2 <- 8
n <- 15; Y <- 53; sy2 <- 9


```


### 問題2

<http://www.geisya.or.jp/~mwm48961/statistics/ttest_question2.htm>

下の表はある教科を旧方式で指導した学級と新方式で指導した学級のテスト結果だとします。新方式の指導方法には効果があると言えるかどうか検定してください。（分散の検定はせず，`t.test()` をオプションなしで使う。）

<div style="width:200px;">

| 新方式 | 旧方式 |
|-------:|-------:|
| 79 | 63 |
| 77 | 64 |
| 74 | 89 |
| 65 | 83 |
| 78 | 69 |
| 71 | 68 |
| 81 | 77 |
| 78 | 74 |
| 70 | 80 |
| 79 | 82 |
| 87 | 72 |
| 62 | 88 |
| 68 | 84 |
| 65 | 85 |
| 89 | 89 |

</div>

```{r welch2, exercise = TRUE}


```

## 3. 一元配置分散分析 {#oneway}


### 3.1. フォーミュラ


```r
y ~ x
```

は「`y` を `x` で回帰する」というモデルを表す。このようなモデルを表す記法を「フォーミュラ」という。右辺に複数の変数を使いたい場合は次のようにする。

```r
y ~ x + w
```

これは「`y` を `x` と `w` で回帰する」モデルを表す。


`x` と `w` の相互作用について関心がある場合には 

```r
y ~ x * w
```

を使うと，`x` と `w` の可能な組み合わせを考慮して回帰する。 

### 3.2. 一元配置分散分析

一元配置分散分析は平均値の差の検定を3つ以上の群に対して適用しようというものである。

次のようなデータがあったとき，処理の違いは結果の違いを生んでいるだろうか？

<div style="width: 350px;">

| 処理A | 処理B | 処理C | 処理D | 処理E |
|------:|------:|------:|------:|------:|
| 310 | 353 | 366 | 299 | 367 |
| 284 | 293 | 335 | 264 | 314 |
| 307 | 306 | 339 | 311 | 377 |
| 267 | 312 | 312 | 266 | 342 |

</div>

データとグループの情報を次のような形式で記録する。

```{r, echo=TRUE}
df <- data.frame(
  yield = c(310, 284, 307, 267,
            353, 293, 306, 312,
            366, 335, 339, 312,
            299, 264, 311, 266,
            367, 314, 377, 342),
  group = factor(rep(LETTERS[1:5], each = 4))
)
df
```

そして，`anova` と `lm` を使う。`lm` は linear model の略である。一元配置分散分析は線形モデルを仮定していたことを思い出そう。

```{r, echo=TRUE}
anova(lm(yield ~ group, data = df))
```

これと同じ結果が `oneway.test()` でも得られる。（ただし等分散を仮定するオプション `var.equal=TRUE` を付けなければ同じ数字にはならない。）


```{r, echo=TRUE}
oneway.test(yield ~ group, data = df, var.equal = TRUE)
```



### 問題

R のサンプルデータ `sleep` に対して一元配置分散分析を実施しなさい。結果はどのように解釈できるか？

```{r, echo=TRUE}
sleep
```

```{r oneway1, exercise=TRUE}

```




## 4. 二元配置分散分析 {#twoway}


グループ分けが2つになる場合がある。例えば，薬Aの投与量と薬Bの投与量を変えて，各組み合わせごとにいくつかデータを取るようなケース。下のデータはそのようになっている。

```{r}
df <- read.csv(system.file('extdata', 'KnK-anova.csv', package = "R4FunDrill"))
df
```



### 問題

上のデータに対して二元配置分散分析を行い，結果を解釈してください。モデルとしては「`Value ~ A * B`」を使うとよい。（`factor` するのを忘れないように）

```{r twoway1, exercise=TRUE, exercise.lines=6}
df <- read.csv(system.file('extdata', 'KnK-anova.csv', package = "R4FunDrill"))
df$A <- factor(df$A)
df$B <- factor(df$B)


```




