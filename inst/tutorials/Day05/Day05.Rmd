---
title: "Day05 ドリル"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

## 1. 検定の復習 {#review}

t-検定には `t.test()`, 2項検定には `binom.test()` を使う。計算機的には2項検定でも問題がない場合でも，統計学の教科書では正規近似と正規分布表を用いて検定をすることが多いので注意する。いずれにせよ理屈がわかれば怖くない。

以下，久保川・国友とあるのは久保川・国友『統計学』を指す。


### 問題（久保川・国友 p.233）

1. あるサイコロを 600回投げて 120回3の目が出た。このサイコロは正しく作られているかを有意水準5%で検定せよ。
2. あるサイコロを 600回投げて 120回3の目が出た。このサイコロは正しく作られているかを有意水準1%で検定せよ。

```{r sandbox1, exercise = TRUE}

```

### 問題（久保川・国友 p.234）

ある部品を製造している向上では不良率は1%であると主張している。そこで200個の製品を調べてみたところ 5個の不良品が見つかった。不良率1%という主張は正しいかを有意水準5% で検定せよ。

```{r sandbox2, exercise = TRUE}

```

### 問題（久保川・国友 p.234）

ある市の市長選挙では，2人の候補A氏とB氏のみが対立している。同市の人200人をランダムに抽出して支持を聞いたところ，95人がA氏支持，105人がB氏支持と答えた。B氏はA氏よりも優勢と言えるか。

ヒント：A氏の支持率を $\mu$ とする。A氏とB氏の間に差がないとする帰無仮説 $\mu=0.5$ に対して対立仮説を $\mu < 0.5$とする「片側検定」をする。（`alternative = 'less'` パラメータを使う）

```{r sandbox3, exercise = TRUE}

```

## 2. 信頼区間 {#confidence}

### 問題

```{r confing-quiz, echo=FALSE}
quiz(caption = "",
  question("信頼区間に関して正しい主張を1つ選びなさい。",
    answer("95% 信頼区間にはデータのうち 95% 以上が入る。"),
    answer("95% 信頼区間は 99% 信頼区間よりも広い。"),
    answer("帰無仮説を変えると信頼区間も変わる"),
    answer("信頼水準は，信頼区間が推定したい値を含んでいる確率である。", correct = TRUE),
    random_answer_order = TRUE,
    allow_retry = TRUE)
  )
```


### 問題

先程のサイコロの問題（「あるサイコロを 600回投げて 120回3の目が出た。このサイコロは正しく作られているかを有意水準1%で検定せよ」）で 3の目が出る回数の 99% 信頼区間を求めるには次のようにするとよい。

```{r binom-test-1, exercise = TRUE}
binom.test(120, 600, conf.level = 0.99)$conf.int * 600
```

このコードおよび `help(binom.test)` を読んで，コードの各パーツにどのような意味があるかを理解してください。

1. `conf.level = 0.99` はどのような意味か
1. `$conf.int` はどのような値を出力するか
1. `* 600` としているのはなぜか


### 問題（久保川・国友 p.208）

新しい税制に賛成する人の割合 $p$ について知りたいので世論調査が行われた。2,500人中1,012人が賛成したとするとき， $p$ の95% 信頼区間を求めよ。

```{r sandbox5, exercise = TRUE}

```



### 問題（久保川・国友 p.209）

ランダムに選んだ大学生400人のうち，運転免許をもっている学生が250人いた。信頼区間95%で，運転免許をもっている学生の割合の信頼区間を求めよ。

```{r sandbox4, exercise = TRUE}

```


## 3. サンプルサイズ {#sample-size}

2値確率変数 $X_i$ で 1が出る確率を $p$ とする。$\sum X_i$ は二項分布に従い，
平均は $np$，分散は $np(1-p)$ である。標本平均の期待値は $p$, 標本平均の分散は $p(1-p)/n$ となる。

ここでサンプル数 $n$ が十分大きいとして，1 が出る割合 $\hat{p} = \bar{X}$ の分布を正規分布で近似する。

$$
\hat{p} = \frac{1}{n}\sum_{i=1}^n X_i \sim \mathcal{N}(p, p(1-p)/n)
$$

平均の信頼区間を求めるときには，分散の推定値が必要なので，これは $\hat{p}(1-\hat{p})/n$ を用いる。

$p$ の周りで標準化すると

$$
\mathrm{Prob}\left\{
  q^{\alpha/2} \le \frac{\hat{p} - p}{\sqrt{\hat{p}(1-\hat{p})/n}} \le q^{1 - \alpha/2} 
\right\}
=
1 - \alpha
$$

が言える。ただし，$q^\alpha$ は標準正規分布の下側 $100\alpha$% 点である。


正規分布は左右対称な分布なので $q^{\alpha/2} = - q^{1-\alpha/2}$ が成り立つことに注意しよう。


$$
\mathrm{Prob}\left\{
  |p - \hat{p}| \le q^{1-\alpha/2} \sqrt{\hat{p}(1-\hat{p})/n} 
\right\}
=
1 - \alpha
$$

未知の $p$ を $\hat{p}$ で推定するときの予測誤差が 

$$q^{1-\alpha/2} \sqrt{\hat{p}(1-\hat{p})/n}$$

である。この予測誤差の見積もりは $100(1-\alpha)$% の確率で正しい見積もりである。この誤差について次のことが言える。

- $\alpha$ が小さくなると誤差は大きくなる。間違えを起こさないように信頼水準を上げようとすれば保守的な見積もりをしなければいけなくなる。
- $n$ が大きくなると誤差は小さくなる。つまり，標本をたくさん集めると母集団に関する予測の精度が向上する。


以上の考え方を使えば，次のような問題に回答を与えることができる。


### 問題（久保川・国友 p.209）

世論調査で，ある政策に反対している有権者の割合を，確率99%で推定誤差を2%ポイント以内で推定したい。標本サイズはどの程度あればよいか？

**考え方**

$\alpha = 0.01$ とする。予測誤差は 0.02 以下でなければならない。

$$
q^{1-\alpha/2} \sqrt{\hat{p}(1-\hat{p})/n} \le 0.02
$$

これを $n$ について解いて

$$
n \ge 
\hat{p}(1-\hat{p})
\left(
   \frac{q^{1-\alpha/2}}{0.02}
\right)^2
$$

を得る。

$\hat{p}$ は未知なので，最悪ケースの見積もり $\max_{\hat{p}} \hat{p}(1-\hat{p}) = 1/4$ を用いると

$$
n \ge 
\frac{1}{4}
\left(
   \frac{q^{1-\alpha/2}}{0.02}
\right)^2
$$

を得る。この式を使って，何人のサンプルが必要かを計算してみよう（答え: 4147）。

```{r sandbox-6, exercise=TRUE}

```



